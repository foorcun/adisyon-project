<div class="odeme-page">
  <!-- Orders exist -->
  <div
    *ngIf="odemePageFacadeService.orders$ | async as orders; else noOrders"
    class="order-group"
  >
    <div *ngFor="let order of orders" class="mb-3">
      <div class="order-items">
        <ul>
          <li
            *ngFor="let item of order.items"
            class="order-item"
            [class.selected]="isSelected(item)"
            (click)="selectItem(item, order)"
            tabindex="0"
            role="button"
            [attr.aria-pressed]="isSelected(item)"
          >
            <div class="item-wrapper d-flex justify-content-between align-items-center">
              <span class="item-content">
                {{ item.product.name }} - {{ item.product.price }}₺ - x{{ item.quantity }}
                <span *ngIf="getSelectedCount(item) > 0" class="selected-count ms-2">
                  ({{ getSelectedCount(item) }}/{{ item.quantity }})
                </span>
              </span>

              <!-- Deselect button (only visible when selected) -->
              <button
                *ngIf="isSelected(item)"
                class="btn btn-sm btn-outline-light deselect-btn"
                (click)="onDeselectClick($event, item)"
                aria-label="Ürünü geri al"
              >
                <i class="fas fa-rotate-left"></i>
              </button>

              <!-- Spacer to preserve layout -->
              <span *ngIf="!isSelected(item)" class="deselect-spacer" aria-hidden="true"></span>
            </div>
          </li>
        </ul>
      </div>
    </div>

    <!-- Total of selected items -->
    <div *ngIf="selectedTotal > 0" class="mt-4 text-end">
      <h5>
        Seçilen Ürünlerin Toplamı:
        <strong>{{ selectedTotal | number: '1.2-2' }}₺</strong>
      </h5>
    </div>
  </div>

  <!-- No Orders Message -->
  <ng-template #noOrders>
    <p class="no-orders-message">Bu masa için sipariş bulunamadı.</p>
  </ng-template>
</div>
