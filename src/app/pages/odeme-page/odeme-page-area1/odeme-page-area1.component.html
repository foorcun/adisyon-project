<div class="odeme-page">
  <!-- Orders Exist -->
  <div
    *ngIf="odemePageFacadeService.orders$ | async as orders; else noOrders"
    class="order-group"
  >
    <!-- üîµ Unpaid Items -->
    <div *ngIf="unpaidItems.length > 0">
      <h6 class="text-primary fw-bold">üîµ √ñdenmemi≈ü Olanlar</h6>
      <ul class="mb-3">
        <li
          *ngFor="let item of unpaidItems"
          class="order-item"
          [class.selected]="isSelected(item)"
          (click)="onSelect(item)"
          tabindex="0"
          role="button"
        >
          <div
            class="item-wrapper d-flex justify-content-between align-items-center"
          >
            <span class="item-content">
              <!-- {{ item.product.id }} {{ item.product.name }} - -->
              {{ item.product.name }} -
              {{ item.product.price }}‚Ç∫ - x{{ item.quantity }}
              <span class="ms-2 item-content">
                ({{ getPaidCount(item) }}/{{ item.quantity }} √∂denmi≈ü)
                <!-- ({{ findProductSubPayments(item.product.id) }}/{{ item.quantity }} √∂denmi≈ü) -->
                <!-- <div
                  *ngIf="
                    paymentService.selectedProductQuantities$
                      | async as productCounts
                  "
                >
                  <div *ngFor="let productCount of productCounts">
                    <p *ngIf="item.product.id == productCount.productId">
                      Product ID: {{ productCount.productId }} --- Total
                      Quantity: {{ productCount.totalQuantity }}
                    </p>
                  </div>
                </div> -->
              </span>
              <span
                *ngIf="getSelectedCount(item) > 0"
                class="selected-count ms-2"
              >
                (se√ßili: {{ getSelectedCount(item) }})
              </span>
            </span>
            <button
              *ngIf="isSelected(item)"
              class="btn btn-sm btn-outline-light deselect-btn"
              (click)="onDeselect($event, item)"
              aria-label="√úr√ºn√º geri al"
            >
              <i class="fas fa-rotate-left"></i>
            </button>
          </div>
        </li>
      </ul>
    </div>

    <!-- ‚úÖ Paid Items -->
    <div *ngIf="paidItems.length > 0">
      <h6 class="text-success fw-bold">‚úÖ √ñdenmi≈ü Olanlar</h6>
      <ul class="mb-3">
        <li *ngFor="let item of paidItems" class="order-item paid">
          <div
            class="item-wrapper d-flex justify-content-between align-items-center"
          >
            <span class="item-content">
              {{ item.product.name }} - {{ item.product.price }}‚Ç∫ - x{{
                item.quantity
              }}
              <span class="ms-2 text-muted">
                ({{ getPaidCount(item) }}/{{ item.quantity }} √∂denmi≈ü)
              </span>
            </span>
            <span class="deselect-spacer"></span>
          </div>
        </li>
      </ul>
    </div>

    <!-- üí∞ Total Selected -->
    <div *ngIf="selectedTotal > 0" class="mt-4 text-end">
      <h5>
        Se√ßilen √úr√ºnlerin Toplamƒ±:
        <strong>{{ selectedTotal | number : "1.2-2" }}‚Ç∫</strong>
      </h5>
    </div>
  </div>

  <!-- üö´ No Orders Message -->
  <ng-template #noOrders>
    <p class="no-orders-message">Bu masa i√ßin sipari≈ü bulunamadƒ±.</p>
  </ng-template>
</div>
